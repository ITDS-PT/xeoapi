# XEO API 2.0 Concepts

The XEO API 2.0 is a set of wrappers to provide a more convenient API to include the folllowing:

- Strongly typed Objects (instead of using a boObject instance for everything)
- Strongly typed attribute values and the use of getter and setters
- Exposing lists of objects and attribute collections as java.util.Collection
- Exposing .xeolov files as types

This document explains how the XEOAPI 2.0 works in broad concepts.

### Instalation

To install the XEOAPI you require the following:
* Add the xeoapi20.jar to the classpath (for instance to the base_lib/modules_libs folder)
* Install XEO Studio version 1.X or superior
* Activate the new API by going to Project Properties -> XEO Studio and check the  **Use XEO Studio New Style API** checkbox
* In the XEO Studio Builder view you can check the status of each build (whenever you save an XEOModel file, it triggers the new api build)
* You have to update the XEO Servlet (XUIServlet.java) to associate the EboContext to the default scope*

Note: You need to change the XUIServlet (or any other servlet to wrap the default context in a scope) to have the following:
```java
boApplication.currentContext().addEboContext( oEboContext );
XEOApplication.wrapScope().setCurrentScope();
//Regular Servlet code

// Finally
XEOThreadLocalScope.unSetDefaultScope();

```


The XEO API 2.0 builds on the existing API, and is an API that is generated by the API Builder. It uses the existing XEOModel definitions to create the classes to support the API.

### Source Folders and Building

BaseClasses are generated to a .src-internal folder and are **not meant to be manipulated by the developer**.

The API itself is generated to the src-xeogen folder (default value, can be changed) and it generates a class for each object and a class for each object factory. These classes are generated once and never changed again, which means you can place code inside these classes (methods essentially) to belong with that particular model. You can think of it as the services the model/model factory provides.

Each time you save the XEOModel, the Studio Builder will trigger a new build of the API.

For each model, at least 4 classes are generated (take Demo as an example)
- DemoBase (generated class each time the model is saved)
- DemoFactoryBase (generated factory each time the model is saved)
- Demo (generated once, you can put your code in this class. Extends DemoBase)
- DemoFactory (generated once, you can put your code in this class. Extends DemoFactoryBase)

In each BaseClass you will find an inner static class with the name "Names" which provides a list of constants with each of the models attributes names. In our Demo example it would be the following:

```java
public static class Names extends XEOModelObject.Names {
		// Simple Attributes
		public static final String NAME = "name";
		public static final String AGE = "age";
		public static final String HEIGHT = "height";
		public static final String DATE_BIRTH = "dateBirth";
		public static final String PLAYS_SPORTS = "playsSports";
		public static final String PICTURE = "picture";
		public static final String STATE = "state";
		
		// Object Attributes
		public static final String BEST_FRIEND = "bestFriend";
		
		// Object Collections
		public static final String FAMILY = "family";

```

Also for each List of Values declared in a .xeolov file another class with be created. For each interface (*.ixeomodel) a Java interface will also be created, all models implementing the interface will see their respective java classes implementing the generated interface.


### API Hierarchy (BaseClass)

Each *Base class extends the XEOModel class which provides the following features

##### Attributes (Getter / Setter )

- modelName (getModelName())
- Boui (getBoui())
- creationDate (getCreationDate())
- lastSaveDate (getLastSaveDate())
- creator (get/setCreator)
- parent (get/setParent)

modelName, boui, creationDate and lastSaveDate, naturally don't provide setters.

##### Methods

- save (Saves the instance)
- destroy (Deletes the instance from the database)
- toString (To help debug - displays the object as JSON String)
- cardId (the object's cardId)
- cardIdIcon (the object's cardId with the icon appended)
- name (the name of the model - same as getModelName())
- exists (whether the instance is persisted in the database or not)
- isChanged (whether some attribute of the instance was changed)
- disable (set the object and its attributes to the disabled state)
- enable (set the object and its attributes to the enabled state)
- isDisabled (whether the instance is disabled or not)
- isValid (validates the instance and returns whether its valid or not)
- errors (see bellow)
- parameters (see bellow)

##### Errors

If you need to add an error message to the instance or to any of the attributes, you can do so like the following:

```java
	Demo demo = DemoFactory.get().load(SOME_BOUI);
    demo.errors().addErrorMessage("Instance level error");
    demo.errors().addErrorMessage("attributeName","Attribute level error");
    demo.errors().addErrorMessage(
    	demo.attributes().getName()
        ,"Attribute level error");

```

You can also check if there are attributes in errors like the following

```java
	Demo demo = DemoFactory.get().load(SOME_BOUI);
    demo.errors().hasErrors() //Any type of errors, instance or attributes
    demo.errors().hasErrorsInObjectOnly
    demo.errors().hasErrorsInAttributes
    List<XEOAttribute<?>> attributesInError = demo.errors().attributesInError();
```

Or clear the errors

```java
	Demo demo = DemoFactory.get().load(SOME_BOUI);
    demo.errors().clearErrors() //Clear all errors
    demo.errors().clearObjectErrors() //Clear all errors in the instance only
    demo.errors().clearAttributeErrors() //Clear all errors in the attributes only
    

```


##### Parameters

You can also associate key-value pairs to each instance. These parameters only exist as long as the instance exists, you can manipulate them like this:

```java
	Demo demo = DemoFactory.get().load(SOME_BOUI);
    demo.parameters().put("KEY","VALUE");
    String value = demo.parameters().get("KEY");
    demo.parameters().remove("KEY");

```